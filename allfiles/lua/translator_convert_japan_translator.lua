--- @@ convert_japan_translator
--[[
日文出羅馬字、全形羅馬字、半形片假名、全片假名、全平假名。
--]]

local function revise_input(text)
  if text == "" then return "" end
    text = string.gsub(text, "[.,;]", "")
  return text
end

local function fullshape_input(text)
  if text == "" then return "" end
  text = string.gsub(text, "a", "ａ")
  text = string.gsub(text, "b", "ｂ")
  text = string.gsub(text, "c", "ｃ")
  text = string.gsub(text, "d", "ｄ")
  text = string.gsub(text, "e", "ｅ")
  text = string.gsub(text, "f", "ｆ")
  text = string.gsub(text, "g", "ｇ")
  text = string.gsub(text, "h", "ｈ")
  text = string.gsub(text, "i", "ｉ")
  text = string.gsub(text, "j", "ｊ")
  text = string.gsub(text, "k", "ｋ")
  text = string.gsub(text, "l", "ｌ")
  text = string.gsub(text, "m", "ｍ")
  text = string.gsub(text, "n", "ｎ")
  text = string.gsub(text, "o", "ｏ")
  text = string.gsub(text, "p", "ｐ")
  text = string.gsub(text, "q", "ｑ")
  text = string.gsub(text, "r", "ｒ")
  text = string.gsub(text, "s", "ｓ")
  text = string.gsub(text, "t", "ｔ")
  text = string.gsub(text, "u", "ｕ")
  text = string.gsub(text, "v", "ｖ")
  text = string.gsub(text, "w", "ｗ")
  text = string.gsub(text, "x", "ｘ")
  text = string.gsub(text, "y", "ｙ")
  text = string.gsub(text, "z", "ｚ")
  text = string.gsub(text, "-", "－")
  text = string.gsub(text, "/", "／")
  return text
end

local function halfwidth_katakana_input(text)
  if text == "" then return "" end
  text = string.gsub(text, "zzyi", "ｯｼﾞｨ")
  text = string.gsub(text, "zzye", "ｯｼﾞｪ")
  text = string.gsub(text, "ttyi", "ｯﾁｨ")
  text = string.gsub(text, "ttye", "ｯﾁｪ")
  text = string.gsub(text, "ttsu", "ｯﾂ")
  text = string.gsub(text, "tsyu", "ﾂｭ")
  text = string.gsub(text, "ssyi", "ｯｼｨ")
  text = string.gsub(text, "ssye", "ｯｼｪ")
  text = string.gsub(text, "sshu", "ｯｼｭ")
  text = string.gsub(text, "ssho", "ｯｼｮ")
  text = string.gsub(text, "ssha", "ｯｼｬ")
  text = string.gsub(text, "sshi", "ｯｼ")
  text = string.gsub(text, "rryu", "ｯﾘｭ")
  text = string.gsub(text, "rryo", "ｯﾘｮ")
  text = string.gsub(text, "rryi", "ｯﾘｨ")
  text = string.gsub(text, "rrye", "ｯﾘｪ")
  text = string.gsub(text, "rrya", "ｯﾘｬ")
  text = string.gsub(text, "ppyu", "ｯﾋﾟｭ")
  text = string.gsub(text, "ppyo", "ｯﾋﾟｮ")
  text = string.gsub(text, "ppyi", "ｯﾋﾟｨ")
  text = string.gsub(text, "ppye", "ｯﾋﾟｪ")
  text = string.gsub(text, "ppya", "ｯﾋﾟｬ")
  -- text = string.gsub(text, "nnyu", "ｯﾆｭ")  --少有，多是出：ンユ
  -- text = string.gsub(text, "nnyo", "ｯﾆｮ")  --少有，多是出：ンヨ
  -- text = string.gsub(text, "nnya", "ｯﾆｬ")  --少有，多是出：ンヤ
  -- text = string.gsub(text, "ngyu", "ｷﾟｭ")  --少有，多是出：ﾝｷﾞｭ
  -- text = string.gsub(text, "ngyo", "ｷﾟｮ")  --少有，多是出：ﾝｷﾞｮ
  -- text = string.gsub(text, "ngya", "ｷﾟｬ")  --少有，多是出：ンギャ
  text = string.gsub(text, "mmyu", "ｯﾐｭ")
  text = string.gsub(text, "mmyo", "ｯﾐｮ")
  text = string.gsub(text, "mmyi", "ｯﾐｨ")
  text = string.gsub(text, "mmye", "ｯﾐｪ")
  text = string.gsub(text, "mmya", "ｯﾐｬ")
  text = string.gsub(text, "kkyu", "ｯｷｭ")
  text = string.gsub(text, "kkyo", "ｯｷｮ")
  text = string.gsub(text, "kkyi", "ｯｷｨ")
  text = string.gsub(text, "kkye", "ｯｷｪ")
  text = string.gsub(text, "kkya", "ｯｷｬ")
  text = string.gsub(text, "jjyi", "ｯｼﾞｨ")
  text = string.gsub(text, "jjye", "ｯｼﾞｪ")
  text = string.gsub(text, "hhyu", "ｯﾋｭ")
  text = string.gsub(text, "hhyo", "ｯﾋｮ")
  text = string.gsub(text, "hhyi", "ｯﾋｨ")
  text = string.gsub(text, "hhye", "ｯﾋｪ")
  text = string.gsub(text, "hhya", "ｯﾋｬ")
  text = string.gsub(text, "ggyu", "ｯｷﾞｭ")
  text = string.gsub(text, "ggyo", "ｯｷﾞｮ")
  text = string.gsub(text, "ggyi", "ｯｷﾞｨ")
  text = string.gsub(text, "ggye", "ｯｷﾞｪ")
  text = string.gsub(text, "ggya", "ｯｷﾞｬ")
  -- text = string.gsub(text, "dvyu", "ﾃﾞｭ")  --轉寫後重複dyu
  text = string.gsub(text, "ddyu", "ｯﾁﾞｭ")
  text = string.gsub(text, "ddyo", "ｯﾁﾞｮ")
  text = string.gsub(text, "ddya", "ｯﾁﾞｬ")
  text = string.gsub(text, "ddyi", "ｯﾁﾞｨ")
  text = string.gsub(text, "ddye", "ｯﾁﾞｪ")
  text = string.gsub(text, "cchu", "ｯﾁｭ")
  text = string.gsub(text, "ccho", "ｯﾁｮ")
  text = string.gsub(text, "ccha", "ｯﾁｬ")
  text = string.gsub(text, "cchi", "ｯﾁ")
  text = string.gsub(text, "bbyu", "ｯﾋﾞｭ")
  text = string.gsub(text, "bbyo", "ｯﾋﾞｮ")
  text = string.gsub(text, "bbyi", "ｯﾋﾞｨ")
  text = string.gsub(text, "bbye", "ｯﾋﾞｪ")
  text = string.gsub(text, "bbya", "ｯﾋﾞｬ")
  text = string.gsub(text, "ccyu", "ｯﾁｭ")  --增
  text = string.gsub(text, "ccyo", "ｯﾁｮ")  --增
  text = string.gsub(text, "ccya", "ｯﾁｬ")  --增
  text = string.gsub(text, "ttyu", "ｯﾁｭ")  --增
  text = string.gsub(text, "ttyo", "ｯﾁｮ")  --增
  text = string.gsub(text, "ttya", "ｯﾁｬ")  --增
  text = string.gsub(text, "zzyu", "ｯﾁﾞｭ")  --增
  text = string.gsub(text, "zzyo", "ｯﾁﾞｮ")  --增
  text = string.gsub(text, "zzya", "ｯﾁﾞｬ")  --增
  -- text = string.gsub(text, "zzyu", "ｯｼﾞｭ")  --增
  -- text = string.gsub(text, "zzyo", "ｯｼﾞｮ")  --增
  -- text = string.gsub(text, "zzya", "ｯｼﾞｬ")  --增
  -- text = string.gsub(text, "jjyu", "ｯﾁﾞｭ")  --增
  -- text = string.gsub(text, "jjyo", "ｯﾁﾞｮ")  --增
  -- text = string.gsub(text, "jjya", "ｯﾁﾞｬ")  --增
  text = string.gsub(text, "jjyu", "ｯｼﾞｭ")  --增
  text = string.gsub(text, "jjyo", "ｯｼﾞｮ")  --增
  text = string.gsub(text, "jjya", "ｯｼﾞｬ")  --增
  text = string.gsub(text, "xtsu", "ｯ")  --增
  text = string.gsub(text, "ltsu", "ｯ")  --增
  text = string.gsub(text, "cche", "ｯﾁｪ")  --增
  text = string.gsub(text, "ccye", "ｯﾁｪ")  --增
  text = string.gsub(text, "ssyu", "ｯｼｭ")  --增
  text = string.gsub(text, "ssyo", "ｯｼｮ")  --增
  text = string.gsub(text, "ssya", "ｯｼｬ")  --增
  text = string.gsub(text, "zzu", "ｯｽﾞ")
  text = string.gsub(text, "zzo", "ｯｿﾞ")
  text = string.gsub(text, "zze", "ｯｾﾞ")
  text = string.gsub(text, "zza", "ｯｻﾞ")
  -- text = string.gsub(text, "zyu", "ｽﾞｭ")  --？
  text = string.gsub(text, "zyi", "ｼﾞｨ")
  text = string.gsub(text, "zye", "ｼﾞｪ")
  text = string.gsub(text, "zwi", "ｽﾞｨ")
  text = string.gsub(text, "yyu", "ｯﾕ")
  text = string.gsub(text, "yyo", "ｯﾖ")
  text = string.gsub(text, "yyi", "ｯｲｨ")
  text = string.gsub(text, "yye", "ｯｲｪ")
  text = string.gsub(text, "yya", "ｯﾔ")
  text = string.gsub(text, "xyu", "ｭ")
  text = string.gsub(text, "xyo", "ｮ")
  text = string.gsub(text, "xya", "ｬ")
  text = string.gsub(text, "wyu", "ｳｭ")
  text = string.gsub(text, "wwo", "ｯｦ")
  text = string.gsub(text, "wwa", "ｯﾜ")
  text = string.gsub(text, "whu", "ｳｩ")
  text = string.gsub(text, "who", "ｳｫ")
  text = string.gsub(text, "whi", "ｳｨ")
  text = string.gsub(text, "whe", "ｳｪ")
  text = string.gsub(text, "wha", "ｳｧ")
  text = string.gsub(text, "vyu", "ｳﾞｭ")
  text = string.gsub(text, "vyo", "ｳﾞｮ")
  text = string.gsub(text, "vyi", "ｳﾞｨ")
  text = string.gsub(text, "vye", "ｳﾞｪ")
  text = string.gsub(text, "vya", "ｳﾞｬ")
  -- text = string.gsub(text, "tyu", "ﾃｭ")
  text = string.gsub(text, "tyi", "ﾁｨ")
  text = string.gsub(text, "tye", "ﾁｪ")
  text = string.gsub(text, "twu", "ﾄｩ")
  text = string.gsub(text, "two", "ﾄｫ")
  text = string.gsub(text, "twi", "ﾄｨ")
  text = string.gsub(text, "twe", "ﾄｪ")
  text = string.gsub(text, "twa", "ﾄｧ")
  text = string.gsub(text, "tto", "ｯﾄ")
  text = string.gsub(text, "tte", "ｯﾃ")
  text = string.gsub(text, "tta", "ｯﾀ")
  text = string.gsub(text, "tsu", "ﾂ")
  text = string.gsub(text, "tso", "ﾂｫ")
  text = string.gsub(text, "tsi", "ﾂｨ")
  text = string.gsub(text, "tse", "ﾂｪ")
  text = string.gsub(text, "tsa", "ﾂｧ")
  text = string.gsub(text, "thu", "ﾃｭ")
  text = string.gsub(text, "tho", "ﾃｮ")
  text = string.gsub(text, "thi", "ﾃｨ")
  text = string.gsub(text, "the", "ﾃｪ")
  text = string.gsub(text, "tha", "ﾃｬ")
  -- text = string.gsub(text, "syu", "ｽｭ")
  text = string.gsub(text, "syi", "ｼｨ")
  text = string.gsub(text, "sye", "ｼｪ")
  text = string.gsub(text, "swu", "ｽｩ")
  text = string.gsub(text, "swo", "ｽｫ")
  text = string.gsub(text, "swi", "ｽｨ")
  text = string.gsub(text, "swe", "ｽｪ")
  text = string.gsub(text, "swa", "ｽｧ")
  text = string.gsub(text, "ssu", "ｯｽ")
  text = string.gsub(text, "sso", "ｯｿ")
  text = string.gsub(text, "sse", "ｯｾ")
  text = string.gsub(text, "ssa", "ｯｻ")
  text = string.gsub(text, "shu", "ｼｭ")
  text = string.gsub(text, "sho", "ｼｮ")
  text = string.gsub(text, "sha", "ｼｬ")
  text = string.gsub(text, "shi", "ｼ")
  text = string.gsub(text, "she", "ｼｪ")
  text = string.gsub(text, "ryu", "ﾘｭ")
  text = string.gsub(text, "ryo", "ﾘｮ")
  text = string.gsub(text, "ryi", "ﾘｨ")
  text = string.gsub(text, "rye", "ﾘｪ")
  text = string.gsub(text, "rya", "ﾘｬ")
  text = string.gsub(text, "rru", "ｯﾙ")
  text = string.gsub(text, "rro", "ｯﾛ")
  text = string.gsub(text, "rri", "ｯﾘ")
  text = string.gsub(text, "rre", "ｯﾚ")
  text = string.gsub(text, "rra", "ｯﾗ")
  text = string.gsub(text, "qyu", "ｸｭ")
  text = string.gsub(text, "qyo", "ｸｮ")
  text = string.gsub(text, "qyi", "ｸｨ")
  text = string.gsub(text, "qye", "ｸｪ")
  text = string.gsub(text, "qya", "ｸｬ")
  text = string.gsub(text, "qwu", "ｸｩ")
  text = string.gsub(text, "qwo", "ｸｫ")
  text = string.gsub(text, "qwi", "ｸｨ")
  text = string.gsub(text, "qwe", "ｸｪ")
  text = string.gsub(text, "qwa", "ｸｧ")
  text = string.gsub(text, "pyu", "ﾋﾟｭ")
  text = string.gsub(text, "pyo", "ﾋﾟｮ")
  text = string.gsub(text, "pyi", "ﾋﾟｨ")
  text = string.gsub(text, "pye", "ﾋﾟｪ")
  text = string.gsub(text, "pya", "ﾋﾟｬ")
  text = string.gsub(text, "ppu", "ｯﾌﾟ")
  text = string.gsub(text, "ppo", "ｯﾎﾟ")
  text = string.gsub(text, "ppi", "ｯﾋﾟ")
  text = string.gsub(text, "ppe", "ｯﾍﾟ")
  text = string.gsub(text, "ppa", "ｯﾊﾟ")
  text = string.gsub(text, "nyu", "ﾆｭ")
  text = string.gsub(text, "nyo", "ﾆｮ")
  text = string.gsub(text, "nyi", "ﾆｨ")
  text = string.gsub(text, "nye", "ﾆｪ")
  text = string.gsub(text, "nya", "ﾆｬ")
  -- text = string.gsub(text, "nnu", "ｯﾇ")  --少有
  -- text = string.gsub(text, "nno", "ｯﾉ")  --少有
  -- text = string.gsub(text, "nni", "ｯﾆ")  --少有
  -- text = string.gsub(text, "nne", "ｯﾈ")  --少有
  -- text = string.gsub(text, "nna", "ｯﾅ")  --少有
  text = string.gsub(text, "ngu", "ｸﾟ")
  text = string.gsub(text, "ngo", "ｺﾟ")
  text = string.gsub(text, "ngi", "ｷﾟ")
  text = string.gsub(text, "nge", "ｹﾟ")
  text = string.gsub(text, "nga", "ｶﾟ")
  text = string.gsub(text, "myu", "ﾐｭ")
  text = string.gsub(text, "myo", "ﾐｮ")
  text = string.gsub(text, "myi", "ﾐｨ")
  text = string.gsub(text, "mye", "ﾐｪ")
  text = string.gsub(text, "mya", "ﾐｬ")
  text = string.gsub(text, "mmu", "ｯﾑ")
  text = string.gsub(text, "mmo", "ｯﾓ")
  text = string.gsub(text, "mmi", "ｯﾐ")
  text = string.gsub(text, "mme", "ｯﾒ")
  text = string.gsub(text, "mma", "ｯﾏ")
  text = string.gsub(text, "lyi", "ﾘｨ")
  text = string.gsub(text, "lye", "ﾘｪ")
  text = string.gsub(text, "kyu", "ｷｭ")
  text = string.gsub(text, "kyo", "ｷｮ")
  text = string.gsub(text, "kye", "ｷｪ")
  text = string.gsub(text, "kya", "ｷｬ")
  text = string.gsub(text, "kwu", "ｸｩ")
  text = string.gsub(text, "kwo", "ｸｫ")
  text = string.gsub(text, "kwi", "ｸｨ")
  text = string.gsub(text, "kwe", "ｸｪ")
  text = string.gsub(text, "kwa", "ｸｧ")
  text = string.gsub(text, "kku", "ｯｸ")
  text = string.gsub(text, "kko", "ｯｺ")
  text = string.gsub(text, "kki", "ｯｷ")
  text = string.gsub(text, "kke", "ｯｹ")
  text = string.gsub(text, "kka", "ｯｶ")
  text = string.gsub(text, "jyi", "ｼﾞｨ")
  text = string.gsub(text, "jye", "ｼﾞｪ")
  text = string.gsub(text, "jju", "ｯｼﾞｭ")
  text = string.gsub(text, "jjo", "ｯｼﾞｮ")
  text = string.gsub(text, "jja", "ｯｼﾞｬ")
  text = string.gsub(text, "jji", "ｯｼﾞ")
  text = string.gsub(text, "hyu", "ﾋｭ")
  text = string.gsub(text, "hyo", "ﾋｮ")
  text = string.gsub(text, "hyi", "ﾋｨ")
  text = string.gsub(text, "hye", "ﾋｪ")
  text = string.gsub(text, "hya", "ﾋｬ")
  text = string.gsub(text, "hwu", "ﾎｩ")
  text = string.gsub(text, "hho", "ｯﾎ")
  text = string.gsub(text, "hhi", "ｯﾋ")
  text = string.gsub(text, "hhe", "ｯﾍ")
  text = string.gsub(text, "hha", "ｯﾊ")
  text = string.gsub(text, "gyu", "ｷﾞｭ")
  text = string.gsub(text, "gyo", "ｷﾞｮ")
  text = string.gsub(text, "gyi", "ｷﾞｨ")
  text = string.gsub(text, "gye", "ｷﾞｪ")
  text = string.gsub(text, "gya", "ｷﾞｬ")
  text = string.gsub(text, "gwu", "ｸﾞｩ")
  text = string.gsub(text, "gwo", "ｸﾞｫ")
  text = string.gsub(text, "gwi", "ｸﾞｨ")
  text = string.gsub(text, "gwe", "ｸﾞｪ")
  text = string.gsub(text, "gwa", "ｸﾞｧ")
  text = string.gsub(text, "ggu", "ｯｸﾞ")
  text = string.gsub(text, "ggo", "ｯｺﾞ")
  text = string.gsub(text, "ggi", "ｯｷﾞ")
  text = string.gsub(text, "gge", "ｯｹﾞ")
  text = string.gsub(text, "gga", "ｯｶﾞ")
  text = string.gsub(text, "fyu", "ﾌｭ")
  text = string.gsub(text, "fyo", "ﾌｮ")
  text = string.gsub(text, "fyi", "ﾌｨ")
  text = string.gsub(text, "fye", "ﾌｪ")
  text = string.gsub(text, "fya", "ﾌｬ")
  text = string.gsub(text, "fwu", "ﾌｩ")
  text = string.gsub(text, "fwo", "ﾌｫ")
  text = string.gsub(text, "fwi", "ﾌｨ")
  text = string.gsub(text, "fwe", "ﾌｪ")
  text = string.gsub(text, "fwa", "ﾌｧ")
  text = string.gsub(text, "ffu", "ｯﾌ")
  text = string.gsub(text, "dyu", "ﾁﾞｭ")
  text = string.gsub(text, "dyo", "ﾁﾞｮ")
  text = string.gsub(text, "dya", "ﾁﾞｬ")
  text = string.gsub(text, "dyi", "ﾁﾞｨ")
  text = string.gsub(text, "dye", "ﾁﾞｪ")
  text = string.gsub(text, "dwu", "ﾄﾞｩ")
  text = string.gsub(text, "dwo", "ﾄﾞｫ")
  text = string.gsub(text, "dwi", "ﾄﾞｨ")
  text = string.gsub(text, "dwe", "ﾄﾞｪ")
  text = string.gsub(text, "dwa", "ﾄﾞｧ")
  text = string.gsub(text, "dhu", "ﾃﾞｭ")
  text = string.gsub(text, "dho", "ﾃﾞｮ")
  text = string.gsub(text, "dhi", "ﾃﾞｨ")
  text = string.gsub(text, "dhe", "ﾃﾞｪ")
  text = string.gsub(text, "dha", "ﾃﾞｬ")
  text = string.gsub(text, "ddu", "ｯﾂﾞ")
  text = string.gsub(text, "ddo", "ｯﾄﾞ")
  text = string.gsub(text, "ddi", "ｯﾁﾞ")
  text = string.gsub(text, "dde", "ｯﾃﾞ")
  text = string.gsub(text, "dda", "ｯﾀﾞ")
  text = string.gsub(text, "cyi", "ﾁｨ")
  text = string.gsub(text, "chu", "ﾁｭ")
  text = string.gsub(text, "cho", "ﾁｮ")
  text = string.gsub(text, "cha", "ﾁｬ")
  text = string.gsub(text, "chi", "ﾁ")
  text = string.gsub(text, "byu", "ﾋﾞｭ")
  text = string.gsub(text, "byo", "ﾋﾞｮ")
  text = string.gsub(text, "bye", "ﾋﾞｪ")
  text = string.gsub(text, "bya", "ﾋﾞｬ")
  text = string.gsub(text, "bbu", "ｯﾌﾞ")
  text = string.gsub(text, "bbo", "ｯﾎﾞ")
  text = string.gsub(text, "bbi", "ｯﾋﾞ")
  text = string.gsub(text, "bbe", "ｯﾍﾞ")
  text = string.gsub(text, "bba", "ｯﾊﾞ")
  text = string.gsub(text, "tyu", "ﾁｭ")  --增
  text = string.gsub(text, "tyo", "ﾁｮ")  --增
  text = string.gsub(text, "tya", "ﾁｬ")  --增
  text = string.gsub(text, "xtu", "ｯ")  --增
  text = string.gsub(text, "ltu", "ｯ")  --增
  text = string.gsub(text, "zyu", "ﾁﾞｭ")  --增
  text = string.gsub(text, "zyo", "ﾁﾞｮ")  --增
  text = string.gsub(text, "zya", "ﾁﾞｬ")  --增
  -- text = string.gsub(text, "zyu", "ｼﾞｭ")  --增
  -- text = string.gsub(text, "zyo", "ｼﾞｮ")  --增
  -- text = string.gsub(text, "zya", "ｼﾞｬ")  --增
  text = string.gsub(text, "zzi", "ｯｼﾞｬ")  --增
  text = string.gsub(text, "jyu", "ｼﾞｭ")  --增
  text = string.gsub(text, "jyo", "ｼﾞｮ")  --增
  text = string.gsub(text, "jya", "ｼﾞｬ")  --增
  text = string.gsub(text, "tti", "ｯﾁ")  --增
  text = string.gsub(text, "syu", "ｼｭ")  --增
  text = string.gsub(text, "syo", "ｼｮ")  --增
  text = string.gsub(text, "sya", "ｼｬ")  --增
  text = string.gsub(text, "che", "ﾁｪ")  --增
  text = string.gsub(text, "cye", "ﾁｪ")  --增
  text = string.gsub(text, "ttu", "ｯﾂ")  --增
  text = string.gsub(text, "ssi", "ｯｼ")  --增
  text = string.gsub(text, "lyu", "ｭ")  --增
  text = string.gsub(text, "lyo", "ｮ")  --增
  text = string.gsub(text, "lya", "ｬ")  --增
  text = string.gsub(text, "hhu", "ｯﾌ")  --增
  -- text = string.gsub(text, "jju", "ｯﾁﾞｭ")  --增
  -- text = string.gsub(text, "jjo", "ｯﾁﾞｮ")  --增
  -- text = string.gsub(text, "jja", "ｯﾁﾞｬ")  --增
  text = string.gsub(text, "zu", "ｽﾞ")
  text = string.gsub(text, "zo", "ｿﾞ")
  text = string.gsub(text, "ze", "ｾﾞ")
  text = string.gsub(text, "za", "ｻﾞ")
  text = string.gsub(text, "yu", "ﾕ")
  text = string.gsub(text, "yo", "ﾖ")
  text = string.gsub(text, "yi", "ｲｨ")
  text = string.gsub(text, "ye", "ｲｪ")
  text = string.gsub(text, "ya", "ﾔ")
  text = string.gsub(text, "xu", "ｩ")
  text = string.gsub(text, "xo", "ｫ")
  text = string.gsub(text, "xi", "ｨ")
  text = string.gsub(text, "xe", "ｪ")
  text = string.gsub(text, "xa", "ｧ")
  text = string.gsub(text, "wo", "ｦ")
  text = string.gsub(text, "wi", "ｳｨ")
  text = string.gsub(text, "we", "ｳｪ")
  text = string.gsub(text, "wa", "ﾜ")
  text = string.gsub(text, "vu", "ｳﾞ")
  text = string.gsub(text, "vo", "ｦﾞ")
  -- text = string.gsub(text, "vo", "ｳﾞｫ")
  text = string.gsub(text, "vi", "ｳﾞｨ")
  text = string.gsub(text, "ve", "ｳﾞｪ")
  text = string.gsub(text, "va", "ﾜﾞ")
  -- text = string.gsub(text, "va", "ｳﾞｧ")
  text = string.gsub(text, "to", "ﾄ")
  text = string.gsub(text, "te", "ﾃ")
  text = string.gsub(text, "ta", "ﾀ")
  text = string.gsub(text, "su", "ｽ")
  text = string.gsub(text, "so", "ｿ")
  text = string.gsub(text, "se", "ｾ")
  text = string.gsub(text, "sa", "ｻ")
  text = string.gsub(text, "ru", "ﾙ")
  text = string.gsub(text, "ro", "ﾛ")
  text = string.gsub(text, "ri", "ﾘ")
  text = string.gsub(text, "re", "ﾚ")
  text = string.gsub(text, "ra", "ﾗ")
  text = string.gsub(text, "pu", "ﾌﾟ")
  text = string.gsub(text, "po", "ﾎﾟ")
  text = string.gsub(text, "pi", "ﾋﾟ")
  text = string.gsub(text, "pe", "ﾍﾟ")
  text = string.gsub(text, "pa", "ﾊﾟ")
  text = string.gsub(text, "ov", "ﾟ")
  text = string.gsub(text, "nu", "ﾇ")
  text = string.gsub(text, "no", "ﾉ")
  text = string.gsub(text, "ni", "ﾆ")
  text = string.gsub(text, "ne", "ﾈ")
  text = string.gsub(text, "na", "ﾅ")
  text = string.gsub(text, "mu", "ﾑ")
  text = string.gsub(text, "mo", "ﾓ")
  text = string.gsub(text, "mi", "ﾐ")
  text = string.gsub(text, "me", "ﾒ")
  text = string.gsub(text, "ma", "ﾏ")
  text = string.gsub(text, "lu", "ﾙﾟ")
  text = string.gsub(text, "lo", "ﾛﾟ")
  text = string.gsub(text, "li", "ﾘﾟ")
  text = string.gsub(text, "le", "ﾚﾟ")
  text = string.gsub(text, "la", "ﾗﾟ")
  text = string.gsub(text, "ku", "ｸ")
  text = string.gsub(text, "ko", "ｺ")
  text = string.gsub(text, "ki", "ｷ")
  text = string.gsub(text, "ke", "ｹ")
  text = string.gsub(text, "ka", "ｶ")
  text = string.gsub(text, "ju", "ｼﾞｭ")
  text = string.gsub(text, "jo", "ｼﾞｮ")
  text = string.gsub(text, "ja", "ｼﾞｬ")
  text = string.gsub(text, "ji", "ｼﾞ")
  text = string.gsub(text, "je", "ｼﾞｪ")
  text = string.gsub(text, "ho", "ﾎ")
  text = string.gsub(text, "hi", "ﾋ")
  text = string.gsub(text, "he", "ﾍ")
  text = string.gsub(text, "ha", "ﾊ")
  text = string.gsub(text, "gu", "ｸﾞ")
  text = string.gsub(text, "go", "ｺﾞ")
  text = string.gsub(text, "gi", "ｷﾞ")
  text = string.gsub(text, "ge", "ｹﾞ")
  text = string.gsub(text, "ga", "ｶﾞ")
  text = string.gsub(text, "fu", "ﾌ")
  text = string.gsub(text, "fo", "ﾌｫ")
  text = string.gsub(text, "fi", "ﾌｨ")
  text = string.gsub(text, "fe", "ﾌｪ")
  text = string.gsub(text, "fa", "ﾌｧ")
  text = string.gsub(text, "du", "ﾂﾞ")
  text = string.gsub(text, "do", "ﾄﾞ")
  text = string.gsub(text, "di", "ﾁﾞ")
  text = string.gsub(text, "de", "ﾃﾞ")
  text = string.gsub(text, "da", "ﾀﾞ")
  text = string.gsub(text, "bv", "ﾞ")
  text = string.gsub(text, "bu", "ﾌﾞ")
  text = string.gsub(text, "bo", "ﾎﾞ")
  text = string.gsub(text, "bi", "ﾋﾞ")
  text = string.gsub(text, "be", "ﾍﾞ")
  text = string.gsub(text, "ba", "ﾊﾞ")
  text = string.gsub(text, "ev", "ｰ")
  text = string.gsub(text, "av", "･")
  text = string.gsub(text, "si", "ｼ")  --增
  text = string.gsub(text, "ti", "ﾁ")  --增
  text = string.gsub(text, "hu", "ﾌ")  --增
  text = string.gsub(text, "zi", "ｼﾞ")  --增
  text = string.gsub(text, "tu", "ﾂ")  --增
  -- text = string.gsub(text, "lu", "ｩ")  --增
  -- text = string.gsub(text, "lo", "ｫ")  --增
  -- text = string.gsub(text, "li", "ｨ")  --增
  -- text = string.gsub(text, "le", "ｪ")  --增
  -- text = string.gsub(text, "la", "ｧ")  --增
  text = string.gsub(text, "q", "ｯ")
  text = string.gsub(text, "u", "ｳ")
  text = string.gsub(text, "o", "ｵ")
  text = string.gsub(text, "n", "ﾝ")
  text = string.gsub(text, "i", "ｲ")
  text = string.gsub(text, "e", "ｴ")
  text = string.gsub(text, "a", "ｱ")
  text = string.gsub(text, "/", "･")
  text = string.gsub(text, "-", "ｰ")
  return text
end

local function katakana_input(text)
  if text == "" then return "" end
  text = string.gsub(text, "ｶﾞ", "ガ")
  text = string.gsub(text, "ｷﾞ", "ギ")
  text = string.gsub(text, "ｸﾞ", "グ")
  text = string.gsub(text, "ｹﾞ", "ゲ")
  text = string.gsub(text, "ｺﾞ", "ゴ")
  text = string.gsub(text, "ｻﾞ", "ザ")
  text = string.gsub(text, "ｼﾞ", "ジ")
  text = string.gsub(text, "ｽﾞ", "ズ")
  text = string.gsub(text, "ｾﾞ", "ゼ")
  text = string.gsub(text, "ｿﾞ", "ゾ")
  text = string.gsub(text, "ﾀﾞ", "ダ")
  text = string.gsub(text, "ﾁﾞ", "ヂ")
  text = string.gsub(text, "ﾂﾞ", "ヅ")
  text = string.gsub(text, "ﾃﾞ", "デ")
  text = string.gsub(text, "ﾄﾞ", "ド")
  text = string.gsub(text, "ﾊﾞ", "バ")
  text = string.gsub(text, "ﾋﾞ", "ビ")
  text = string.gsub(text, "ﾌﾞ", "ブ")
  text = string.gsub(text, "ﾍﾞ", "ベ")
  text = string.gsub(text, "ﾎﾞ", "ボ")
  text = string.gsub(text, "ﾊﾟ", "パ")
  text = string.gsub(text, "ﾋﾟ", "ピ")
  text = string.gsub(text, "ﾌﾟ", "プ")
  text = string.gsub(text, "ﾍﾟ", "ぺ")
  text = string.gsub(text, "ﾎﾟ", "ポ")
  text = string.gsub(text, "ｳﾞ", "ヴ")
  text = string.gsub(text, "ﾜﾞ", "ヷ")
  text = string.gsub(text, "ｦﾞ", "ヺ")
  text = string.gsub(text, "ｱ", "ア")
  text = string.gsub(text, "ｲ", "イ")
  text = string.gsub(text, "ｳ", "ウ")
  text = string.gsub(text, "ｴ", "エ")
  text = string.gsub(text, "ｵ", "オ")
  text = string.gsub(text, "ｶ", "カ")
  text = string.gsub(text, "ｷ", "キ")
  text = string.gsub(text, "ｸ", "ク")
  text = string.gsub(text, "ｹ", "ケ")
  text = string.gsub(text, "ｺ", "コ")
  text = string.gsub(text, "ｻ", "サ")
  text = string.gsub(text, "ｼ", "シ")
  text = string.gsub(text, "ｽ", "ス")
  text = string.gsub(text, "ｾ", "セ")
  text = string.gsub(text, "ｿ", "ソ")
  text = string.gsub(text, "ﾀ", "タ")
  text = string.gsub(text, "ﾁ", "チ")
  text = string.gsub(text, "ﾂ", "ツ")
  text = string.gsub(text, "ﾃ", "テ")
  text = string.gsub(text, "ﾄ", "ト")
  text = string.gsub(text, "ﾅ", "ナ")
  text = string.gsub(text, "ﾆ", "ニ")
  text = string.gsub(text, "ﾇ", "ヌ")
  text = string.gsub(text, "ﾈ", "ネ")
  text = string.gsub(text, "ﾉ", "ノ")
  text = string.gsub(text, "ﾊ", "ハ")
  text = string.gsub(text, "ﾋ", "ヒ")
  text = string.gsub(text, "ﾌ", "フ")
  text = string.gsub(text, "ﾍ", "ヘ")
  text = string.gsub(text, "ﾎ", "ホ")
  text = string.gsub(text, "ﾏ", "マ")
  text = string.gsub(text, "ﾐ", "ミ")
  text = string.gsub(text, "ﾑ", "ム")
  text = string.gsub(text, "ﾒ", "メ")
  text = string.gsub(text, "ﾓ", "モ")
  text = string.gsub(text, "ﾔ", "ヤ")
  text = string.gsub(text, "ﾕ", "ユ")
  text = string.gsub(text, "ﾖ", "ヨ")
  text = string.gsub(text, "ﾗ", "ラ")
  text = string.gsub(text, "ﾘ", "リ")
  text = string.gsub(text, "ﾙ", "ル")
  text = string.gsub(text, "ﾚ", "レ")
  text = string.gsub(text, "ﾛ", "ロ")
  text = string.gsub(text, "ﾜ", "ワ")
  text = string.gsub(text, "ｦ", "ヲ")
  text = string.gsub(text, "ﾝ", "ン")
  text = string.gsub(text, "ｧ", "ァ")
  text = string.gsub(text, "ｨ", "ィ")
  text = string.gsub(text, "ｩ", "ゥ")
  text = string.gsub(text, "ｪ", "ェ")
  text = string.gsub(text, "ｫ", "ォ")
  text = string.gsub(text, "ｬ", "ャ")
  text = string.gsub(text, "ｭ", "ュ")
  text = string.gsub(text, "ｮ", "ョ")
  text = string.gsub(text, "ｯ", "ッ")
  text = string.gsub(text, "･", "・")
  text = string.gsub(text, "ｰ", "ー")
  text = string.gsub(text, "ﾞ", "゛")
  text = string.gsub(text, "ﾟ", "゜")
  return text
end

local function hiragana_input(text)
  if text == "" then return "" end
  text = string.gsub(text, "ｶﾞ", "が")
  text = string.gsub(text, "ｷﾞ", "ぎ")
  text = string.gsub(text, "ｸﾞ", "ぐ")
  text = string.gsub(text, "ｹﾞ", "げ")
  text = string.gsub(text, "ｺﾞ", "ご")
  text = string.gsub(text, "ｻﾞ", "ざ")
  text = string.gsub(text, "ｼﾞ", "じ")
  text = string.gsub(text, "ｽﾞ", "ず")
  text = string.gsub(text, "ｾﾞ", "ぜ")
  text = string.gsub(text, "ｿﾞ", "ぞ")
  text = string.gsub(text, "ﾀﾞ", "だ")
  text = string.gsub(text, "ﾁﾞ", "ぢ")
  text = string.gsub(text, "ﾂﾞ", "づ")
  text = string.gsub(text, "ﾃﾞ", "で")
  text = string.gsub(text, "ﾄﾞ", "ど")
  text = string.gsub(text, "ﾊﾞ", "ば")
  text = string.gsub(text, "ﾋﾞ", "び")
  text = string.gsub(text, "ﾌﾞ", "ぶ")
  text = string.gsub(text, "ﾍﾞ", "べ")
  text = string.gsub(text, "ﾎﾞ", "ぼ")
  text = string.gsub(text, "ﾊﾟ", "ぱ")
  text = string.gsub(text, "ﾋﾟ", "ぴ")
  text = string.gsub(text, "ﾌﾟ", "ぷ")
  text = string.gsub(text, "ﾍﾟ", "ぺ")
  text = string.gsub(text, "ﾎﾟ", "ぽ")
  text = string.gsub(text, "ｳﾞ", "ゔ")
  -- text = string.gsub(text, "ﾜﾞ", "")
  -- text = string.gsub(text, "ｦﾞ", "")
  text = string.gsub(text, "ｱ", "あ")
  text = string.gsub(text, "ｲ", "い")
  text = string.gsub(text, "ｳ", "う")
  text = string.gsub(text, "ｴ", "え")
  text = string.gsub(text, "ｵ", "お")
  text = string.gsub(text, "ｶ", "か")
  text = string.gsub(text, "ｷ", "き")
  text = string.gsub(text, "ｸ", "く")
  text = string.gsub(text, "ｹ", "け")
  text = string.gsub(text, "ｺ", "こ")
  text = string.gsub(text, "ｻ", "さ")
  text = string.gsub(text, "ｼ", "し")
  text = string.gsub(text, "ｽ", "す")
  text = string.gsub(text, "ｾ", "せ")
  text = string.gsub(text, "ｿ", "そ")
  text = string.gsub(text, "ﾀ", "た")
  text = string.gsub(text, "ﾁ", "ち")
  text = string.gsub(text, "ﾂ", "つ")
  text = string.gsub(text, "ﾃ", "て")
  text = string.gsub(text, "ﾄ", "と")
  text = string.gsub(text, "ﾅ", "な")
  text = string.gsub(text, "ﾆ", "に")
  text = string.gsub(text, "ﾇ", "ぬ")
  text = string.gsub(text, "ﾈ", "ね")
  text = string.gsub(text, "ﾉ", "の")
  text = string.gsub(text, "ﾊ", "は")
  text = string.gsub(text, "ﾋ", "ひ")
  text = string.gsub(text, "ﾌ", "ふ")
  text = string.gsub(text, "ﾍ", "へ")
  text = string.gsub(text, "ﾎ", "ほ")
  text = string.gsub(text, "ﾏ", "ま")
  text = string.gsub(text, "ﾐ", "み")
  text = string.gsub(text, "ﾑ", "む")
  text = string.gsub(text, "ﾒ", "め")
  text = string.gsub(text, "ﾓ", "も")
  text = string.gsub(text, "ﾔ", "や")
  text = string.gsub(text, "ﾕ", "ゆ")
  text = string.gsub(text, "ﾖ", "よ")
  text = string.gsub(text, "ﾗ", "ら")
  text = string.gsub(text, "ﾘ", "り")
  text = string.gsub(text, "ﾙ", "る")
  text = string.gsub(text, "ﾚ", "れ")
  text = string.gsub(text, "ﾛ", "ろ")
  text = string.gsub(text, "ﾜ", "わ")
  text = string.gsub(text, "ｦ", "を")
  text = string.gsub(text, "ﾝ", "ん")
  text = string.gsub(text, "ｧ", "ぁ")
  text = string.gsub(text, "ｨ", "ぃ")
  text = string.gsub(text, "ｩ", "ぅ")
  text = string.gsub(text, "ｪ", "ぇ")
  text = string.gsub(text, "ｫ", "ぉ")
  text = string.gsub(text, "ｬ", "ゃ")
  text = string.gsub(text, "ｭ", "ゅ")
  text = string.gsub(text, "ｮ", "ょ")
  text = string.gsub(text, "ｯ", "っ")
  text = string.gsub(text, "･", "・")
  text = string.gsub(text, "ｰ", "ー")
  text = string.gsub(text, "ﾞ", "゛")
  text = string.gsub(text, "ﾟ", "゜")
  return text
end




-- 主方案用
local function convert_japan_translator(input, seg)
  local c = string.match(input, "([-/a-z.,;]+)[.][,]$")
  local tag_abc = seg:has_tag("abc")
  if tag_abc and (c~=nil) then
    local halfwidth = halfwidth_katakana_input(revise_input(c))
    yield(Candidate("jp", seg.start, seg._end, revise_input(c), "〔羅馬字〕"))
    yield(Candidate("jp", seg.start, seg._end, fullshape_input(revise_input(c)), "〔全形羅馬字〕"))
    if not string.find(halfwidth, "[a-z]") then
      yield(Candidate("jp", seg.start, seg._end, halfwidth, "〔半形片假名〕"))
      yield(Candidate("jp", seg.start, seg._end, katakana_input(halfwidth), "〔片假名〕"))
      yield(Candidate("jp", seg.start, seg._end, hiragana_input(halfwidth), "〔平假名〕"))
    end
  end
end

-- 掛接方案用，掛接方案名稱「japan」。
local function p_convert_japan_translator(input, seg)
-- local function p_convert_japan_translator(input, seg, env)
  -- local tips_jp = env.engine.schema.config:get_string('japan/tips')
  -- local tips_jp = string.gsub(tips_jp, "▶", "")
  local tips_jp = '《日系列》'
  local c = string.match(input, "([-/a-z.,;]+)[.][,]$")
  local tag_jp = seg:has_tag("japan")
  if tag_jp and (c~=nil) then
    local halfwidth = halfwidth_katakana_input(revise_input(c))
    local rome = Candidate("jp", seg.start, seg._end, revise_input(c), "〔羅馬字〕")
    local rome_f = Candidate("jp", seg.start, seg._end, fullshape_input(revise_input(c)), "〔全形羅馬字〕")
    rome.preedit = tips_jp .. input
    rome_f.preedit = tips_jp .. input
    yield(rome)
    yield(rome_f)
    if not string.find(halfwidth, "[a-z]") then
      local hw = Candidate("jp", seg.start, seg._end, halfwidth, "〔半形片假名〕")
      local kata = Candidate("jp", seg.start, seg._end, katakana_input(halfwidth), "〔片假名〕")
      local hira = Candidate("jp", seg.start, seg._end, hiragana_input(halfwidth), "〔平假名〕")
      hw.preedit = tips_jp .. input
      kata.preedit = tips_jp .. input
      hira.preedit = tips_jp .. input
      yield(hw)
      yield(kata)
      yield(hira)
    end
  end
end

return { convert_japan_translator = convert_japan_translator,
       p_convert_japan_translator = p_convert_japan_translator }